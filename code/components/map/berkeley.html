<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Northern California Hidden Gems</title>
    
    <!-- MapLibre CSS -->
    <link href="https://unpkg.com/maplibre-gl@3.3.1/dist/maplibre-gl.css" rel="stylesheet" />
    
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            position: relative;
            background-color: #f5f5f5;
        }
        
        /* Phone frame for demo */
        .phone-frame {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 375px;
            height: 812px;
            background-color: white;
            border-radius: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            border: 10px solid #111;
            display: flex;
            flex-direction: column;
        }
        
        /* Notch */
        .phone-frame::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 180px;
            height: 30px;
            background-color: #111;
            border-bottom-left-radius: 15px;
            border-bottom-right-radius: 15px;
            z-index: 100;
        }
        
        /* App header */
        .app-header {
            display: flex;
            padding: 15px 20px 10px;
            overflow-x: auto;
            background-color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 10;
        }
        
        .trip-button {
            flex: 0 0 auto;
            padding: 8px 15px;
            margin-right: 10px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            border: none;
            background-color: #f0f0f0;
            white-space: nowrap;
            color: #333;
        }
        
        .trip-button.active {
            background-color: #333;
            color: white;
        }
        
        /* Map container */
        #map {
            flex: 1;
            width: 100%;
            position: relative;
        }
        
        /* Card container */
        .gem-card-container {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 200px;
            z-index: 10;
            transition: transform 0.3s ease;
        }
        
        .cards-container {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 170px;
            z-index: 10;
            overflow: hidden;
        }
        
        .gem-card {
            position: absolute;
            bottom: 0;
            left: 15px;
            right: 15px;
            height: 170px;
            background-color: white;
            border-radius: 15px 15px 0 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            padding: 15px;
            display: flex;
            flex-direction: column;
            transform: translateX(100%);
            transition: transform 0.3s ease-out;
        }
        
        .gem-card.prev {
            transform: translateX(-100%);
            z-index: 1;
        }
        
        .gem-card.active {
            transform: translateX(0);
            z-index: 2;
        }
        
        .gem-card.next {
            transform: translateX(100%);
            z-index: 1;
        }
        
        .card-handle {
            width: 40px;
            height: 4px;
            background-color: #ccc;
            border-radius: 2px;
            margin: 0 auto 15px;
        }
        
        .card-content {
            display: flex;
            flex: 1;
        }
        
        .card-image {
            width: 100px;
            height: 100px;
            background-color: #eee;
            border-radius: 8px;
            margin-right: 15px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            color: #999;
        }
        
        .card-details {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .card-title {
            font-weight: 600;
            font-size: 18px;
            margin-bottom: 5px;
            color: #333;
        }
        
        .card-address {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
        }
        
        .card-address svg {
            width: 14px;
            height: 14px;
            margin-right: 5px;
            fill: #666;
        }
        
        .card-hours {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
        }
        
        .card-hours svg {
            width: 14px;
            height: 14px;
            margin-right: 5px;
            fill: #666;
        }
        
        .add-to-trip-btn {
            background-color: #3a3a3a;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px;
            font-weight: 600;
            font-size: 14px;
            width: 100%;
            margin-top: auto;
            cursor: pointer;
        }
        
        /* Itinerary button */
        .view-itinerary-btn {
            position: absolute;
            top: 80px;
            right: 15px;
            background-color: #333;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 15px;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            z-index: 5;
        }
        
        .view-itinerary-btn svg {
            width: 16px;
            height: 16px;
            margin-right: 5px;
            fill: white;
        }
        
        /* Bottom navigation */
        .bottom-nav {
            display: flex;
            height: 60px;
            background-color: white;
            border-top: 1px solid #eee;
        }
        
        .bottom-nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 12px;
        }
        
        .bottom-nav-item.active {
            color: #333;
        }
        
        .bottom-nav-item svg {
            width: 24px;
            height: 24px;
            margin-bottom: 4px;
            fill: currentColor;
        }
        
        /* Card swipe controls - we'll hide these since we're implementing true swiping */
        .swipe-controls {
            position: absolute;
            bottom: 190px;
            left: 0;
            right: 0;
            display: none; /* Hide the buttons since we'll use swipe gestures */
            justify-content: center;
            z-index: 5;
        }
        
        .swipe-button {
            width: 50px;
            height: 50px;
            border-radius: 25px;
            background-color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            margin: 0 10px;
            border: none;
            font-size: 20px;
            color: #333;
        }
        
        /* Swipe indicators */
        .swipe-indicator {
            position: absolute;
            bottom: 180px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            z-index: 5;
        }
        
        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.5);
            margin: 0 5px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .dot.active {
            background-color: white;
            border: 1px solid rgba(0, 0, 0, 0.2);
        }
        
        /* Hidden gem marker styles */
        .marker {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            border: 3px solid white;
        }
        
        .marker.nature {
            background-color: #27ae60;
        }
        
        .marker.food {
            background-color: #e74c3c;
        }
        
        .marker.cultural {
            background-color: #9b59b6;
        }
        
        .marker.active {
            width: 35px;
            height: 35px;
            z-index: 10;
            animation: pulse 1.5s infinite;
        }
        
        .current-location-marker {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background-color: #000;
            box-shadow: 0 0 0 5px rgba(0,0,0,0.1);
            border: 3px solid white;
        }
        
        .destination-marker {
            width: 30px;
            height: 30px;
            background-color: #6366F1;
            border-radius: 50% 50% 50% 0;
            transform: rotate(-45deg);
            border: 3px solid white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(255,255,255,0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(255,255,255,0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(255,255,255,0);
            }
        }
    </style>
</head>
<body>
    <div class="phone-frame">
        <!-- App header with trip selection -->
        <div class="app-header">
            <button class="trip-button active">Hayward Trip</button>
            <button class="trip-button">Trip to Napa</button>
            <button class="trip-button">Trip to Tahoe</button>
            <button class="trip-button">Trip to Mendocino</button>
        </div>
        
        <!-- Map container -->
        <div id="map"></div>
        
        <!-- Itinerary button -->
        <button class="view-itinerary-btn">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/></svg>
            View Itinerary
        </button>
        
        <!-- Swipe indicators -->
        <div class="swipe-indicator">
            <!-- Will be populated by JavaScript -->
        </div>
        
        <!-- Hidden gem cards container -->
        <div class="cards-container">
            <!-- Cards will be generated dynamically -->
        </div>
        
        <!-- Bottom navigation -->
        <div class="bottom-nav">
            <div class="bottom-nav-item">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
                Explore
            </div>
            <div class="bottom-nav-item active">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
                Trip
            </div>
            <div class="bottom-nav-item">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                Add
            </div>
            <div class="bottom-nav-item">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                Profile
            </div>
        </div>
    </div>

    <!-- MapLibre JS -->
    <script src="https://unpkg.com/maplibre-gl@3.3.1/dist/maplibre-gl.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check if maplibregl is defined
            if (typeof maplibregl === 'undefined') {
                console.error('MapLibre failed to load properly.');
                document.getElementById('map').innerHTML = '<div style="padding: 20px; color: red;">Failed to load MapLibre. Please check console for errors.</div>';
                return;
            }
            
            // Hidden gems data with full coordinates
            const hiddenGems = [
                {
                    id: 'nature1',
                    title: 'Secret Sunol Waterfall',
                    address: '1895 Geary Rd, Sunol, CA',
                    hours: '8:00 AM - Sunset | Free',
                    category: 'nature',
                    coordinates: [-121.8250, 37.5013],
                    description: 'A small hidden waterfall with a natural pool, perfect for a quick dip on hot days',
                    detourTime: '25 mins',
                    popularity: 2
                },
                {
                    id: 'food1',
                    title: 'Mission Peak Vineyard',
                    address: '43682 Mission Blvd, Fremont, CA',
                    hours: '10:00 AM - 6:00 PM | $$',
                    category: 'food',
                    coordinates: [-121.9196, 37.5185],
                    description: 'Small family-owned vineyard with rare local varieties and panoramic bay views',
                    detourTime: '35 mins',
                    popularity: 3
                },
                {
                    id: 'cultural1',
                    title: 'Historic Alviso Adobe',
                    address: '3465 Old Foothill Rd, Pleasanton, CA',
                    hours: '10:00 AM - 4:00 PM | Free',
                    category: 'cultural',
                    coordinates: [-121.8761, 37.6607],
                    description: 'Restored 1854 adobe home showcasing Californio rancho life',
                    detourTime: '20 mins',
                    popularity: 2
                },
                {
                    id: 'nature2',
                    title: 'Sunol Regional Wilderness',
                    address: 'Sunol Regional Wilderness, Sunol, CA',
                    hours: 'Sunrise - Sunset | $6',
                    category: 'nature',
                    coordinates: [-121.7823, 37.5204],
                    description: 'Hidden swimming holes and unusual geological formations called "Little Yosemite"',
                    detourTime: '40 mins',
                    popularity: 3
                },
                {
                    id: 'food2',
                    title: 'Olivina Olive Press',
                    address: '4555 Arroyo Rd, Livermore, CA',
                    hours: 'By appointment | $$',
                    category: 'food',
                    coordinates: [-121.7566, 37.6629],
                    description: 'Historic olive oil producer dating back to 1881 with old-growth olive trees',
                    detourTime: '30 mins',
                    popularity: 1
                }
            ];
            
            // Route data
            const routeData = {
                origin: {
                    name: 'Pleasanton',
                    coordinates: [-121.8746, 37.6624]
                },
                destination: {
                    name: 'Mission San Jos√©',
                    coordinates: [-121.9201, 37.5319]
                },
                mainRoute: [
                    [-121.8746, 37.6624], // Pleasanton
                    [-121.8691, 37.6545],
                    [-121.8647, 37.6451],
                    [-121.8602, 37.6351],
                    [-121.8568, 37.6248],
                    [-121.8546, 37.6149],
                    [-121.8565, 37.6052],
                    [-121.8625, 37.5950],
                    [-121.8694, 37.5858],
                    [-121.8782, 37.5756],
                    [-121.8854, 37.5659],
                    [-121.8935, 37.5569],
                    [-121.9019, 37.5481],
                    [-121.9112, 37.5398],
                    [-121.9201, 37.5319]  // Mission San Jos√©
                ]
            };
            
            // Initialize the map centered on the route area
            const map = new maplibregl.Map({
                container: 'map',
                style: 'https://demotiles.maplibre.org/style.json',
                center: [-121.8823, 37.5972], // Center between Pleasanton and Mission San Jos√©
                zoom: 11,
                pitch: 0,
                attributionControl: false
            });
            
            // Create markers and detour lines for each gem
            let markers = [];
            let activeGemIndex = 0;
            let detourLines = [];
            
            // Create origin and destination markers
            let originMarker, destinationMarker;
            
            // Wait for the map to load
            map.on('load', function() {
                // Add the main route line
                map.addSource('main-route', {
                    'type': 'geojson',
                    'data': {
                        'type': 'Feature',
                        'properties': {},
                        'geometry': {
                            'type': 'LineString',
                            'coordinates': routeData.mainRoute
                        }
                    }
                });
                
                map.addLayer({
                    'id': 'main-route-line',
                    'type': 'line',
                    'source': 'main-route',
                    'layout': {
                        'line-join': 'round',
                        'line-cap': 'round'
                    },
                    'paint': {
                        'line-color': '#000',
                        'line-width': 4
                    }
                });
                
                // Add dotted route decoration
                map.addLayer({
                    'id': 'main-route-dots',
                    'type': 'line',
                    'source': 'main-route',
                    'layout': {
                        'line-join': 'round',
                        'line-cap': 'round'
                    },
                    'paint': {
                        'line-color': '#fff',
                        'line-width': 2,
                        'line-dasharray': [0, 2, 1]
                    }
                });
                
                // Create origin and destination markers
                const originEl = document.createElement('div');
                originEl.className = 'current-location-marker';
                
                originMarker = new maplibregl.Marker(originEl)
                    .setLngLat(routeData.origin.coordinates)
                    .addTo(map);
                
                const destinationEl = document.createElement('div');
                destinationEl.className = 'destination-marker';
                
                destinationMarker = new maplibregl.Marker(destinationEl)
                    .setLngLat(routeData.destination.coordinates)
                    .addTo(map);
                
                // Create a marker and detour line for each gem
                hiddenGems.forEach((gem, index) => {
                    // Create marker element
                    const markerEl = document.createElement('div');
                    markerEl.className = `marker ${gem.category}`;
                    if (index === activeGemIndex) {
                        markerEl.classList.add('active');
                    }
                    
                    // Create marker
                    const marker = new maplibregl.Marker(markerEl)
                        .setLngLat(gem.coordinates)
                        .addTo(map);
                    
                    markers.push(marker);
                    
                    // Create a simplified detour route (this would be replaced with actual routing in a real app)
                    // Find the closest point on the main route to this gem
                    let closestPointIndex = 0;
                    let minDistance = Infinity;
                    
                    routeData.mainRoute.forEach((point, i) => {
                        const distance = calculateDistance(point, gem.coordinates);
                        if (distance < minDistance) {
                            minDistance = distance;
                            closestPointIndex = i;
                        }
                    });
                    
                    // Create a detour path from main route ‚Üí gem ‚Üí main route
                    const detourCoordinates = [
                        routeData.mainRoute[closestPointIndex],
                        gem.coordinates,
                        routeData.mainRoute[closestPointIndex]
                    ];
                    
                    // Add detour source and line
                    map.addSource(`detour-${index}`, {
                        'type': 'geojson',
                        'data': {
                            'type': 'Feature',
                            'properties': {},
                            'geometry': {
                                'type': 'LineString',
                                'coordinates': detourCoordinates
                            }
                        }
                    });
                    
                    // Add detour layer (initially invisible except for active gem)
                    const visibility = index === activeGemIndex ? 'visible' : 'none';
                    
                    map.addLayer({
                        'id': `detour-line-${index}`,
                        'type': 'line',
                        'source': `detour-${index}`,
                        'layout': {
                            'line-join': 'round',
                            'line-cap': 'round',
                            'visibility': visibility
                        },
                        'paint': {
                            'line-color': getCategoryColor(gem.category),
                            'line-width': 3,
                            'line-dasharray': [2, 2]
                        }
                    });
                    
                    detourLines.push(`detour-line-${index}`);
                });
                
                // Create cards and indicators
                createGemCards();
                createSwipeIndicators();
                
                // Set the initial active gem
                updateActiveGem(activeGemIndex);
                
                // Initialize touch handling for swiping
                initSwipeHandling();
            });
            
            // Function to update the active gem
            function updateActiveGem(newIndex) {
                // Remove active class from current marker
                const currentMarkerEl = markers[activeGemIndex].getElement();
                currentMarkerEl.classList.remove('active');
                
                // Hide current detour line
                map.setLayoutProperty(detourLines[activeGemIndex], 'visibility', 'none');
                
                // Get previous active index before updating
                const previousActiveIndex = activeGemIndex;
                
                // Update active index
                activeGemIndex = newIndex;
                
                // Add active class to new marker
                const newMarkerEl = markers[activeGemIndex].getElement();
                newMarkerEl.classList.add('active');
                
                // Show new detour line
                map.setLayoutProperty(detourLines[activeGemIndex], 'visibility', 'visible');
                
                // Fly to the new marker location
                map.flyTo({
                    center: hiddenGems[activeGemIndex].coordinates,
                    zoom: 12,
                    duration: 1000
                });
                
                // Update card positions
                const prevIndex = getPrevIndex(activeGemIndex);
                const nextIndex = getNextIndex(activeGemIndex);
                
                // Remove all position classes
                document.querySelectorAll('.gem-card').forEach(card => {
                    card.classList.remove('active', 'prev', 'next');
                });
                
                // Add appropriate position classes
                document.getElementById(`card-${activeGemIndex}`).classList.add('active');
                document.getElementById(`card-${prevIndex}`).classList.add('prev');
                document.getElementById(`card-${nextIndex}`).classList.add('next');
                
                // Update active indicator dot
                document.querySelectorAll('.dot').forEach((dot, index) => {
                    dot.classList.toggle('active', index === activeGemIndex);
                });
            }
            
            // Initialize touch handling for cards
            function initSwipeHandling() {
                const cardsContainer = document.querySelector('.cards-container');
                
                // Touch tracking variables
                let startX = 0;
                let currentX = 0;
                let isDragging = false;
                const activeCard = document.querySelector('.gem-card.active');
                const threshold = 100; // Minimum distance to trigger swipe
                
                // Touch event handlers
                cardsContainer.addEventListener('touchstart', handleTouchStart, false);
                cardsContainer.addEventListener('touchmove', handleTouchMove, false);
                cardsContainer.addEventListener('touchend', handleTouchEnd, false);
                
                // For desktop testing
                cardsContainer.addEventListener('mousedown', handleMouseDown, false);
                cardsContainer.addEventListener('mousemove', handleMouseMove, false);
                cardsContainer.addEventListener('mouseup', handleMouseUp, false);
                
                // Touch handlers
                function handleTouchStart(e) {
                    startX = e.touches[0].clientX;
                    isDragging = true;
                    
                    // Get current active card
                    const activeCard = document.querySelector('.gem-card.active');
                    const prevCard = document.querySelector('.gem-card.prev');
                    const nextCard = document.querySelector('.gem-card.next');
                    
                    // Reset transitions during drag
                    if (activeCard) activeCard.style.transition = 'none';
                    if (prevCard) prevCard.style.transition = 'none';
                    if (nextCard) nextCard.style.transition = 'none';
                }
                
                function handleTouchMove(e) {
                    if (!isDragging) return;
                    
                    currentX = e.touches[0].clientX;
                    const diffX = currentX - startX;
                    
                    // Get cards
                    const activeCard = document.querySelector('.gem-card.active');
                    const prevCard = document.querySelector('.gem-card.prev');
                    const nextCard = document.querySelector('.gem-card.next');
                    
                    if (activeCard) activeCard.style.transform = `translateX(${diffX}px)`;
                    
                    // Move adjacent cards proportionally
                    if (diffX > 0 && prevCard) {
                        // Swiping right, show prev card
                        prevCard.style.transform = `translateX(calc(-100% + ${diffX}px))`;
                    } else if (diffX < 0 && nextCard) {
                        // Swiping left, show next card
                        nextCard.style.transform = `translateX(calc(100% + ${diffX}px))`;
                    }
                    
                    // Prevent scrolling when swiping
                    e.preventDefault();
                }
                
                function handleTouchEnd(e) {
                    if (!isDragging) return;
                    
                    // Get cards and restore transitions
                    const activeCard = document.querySelector('.gem-card.active');
                    const prevCard = document.querySelector('.gem-card.prev');
                    const nextCard = document.querySelector('.gem-card.next');
                    
                    if (activeCard) activeCard.style.transition = 'transform 0.3s ease-out';
                    if (prevCard) prevCard.style.transition = 'transform 0.3s ease-out';
                    if (nextCard) nextCard.style.transition = 'transform 0.3s ease-out';
                    
                    // Calculate swipe distance
                    const diffX = currentX - startX;
                    
                    if (diffX > threshold) {
                        // Swiped right - go to previous
                        updateActiveGem(getPrevIndex(activeGemIndex));
                    } else if (diffX < -threshold) {
                        // Swiped left - go to next
                        updateActiveGem(getNextIndex(activeGemIndex));
                    } else {
                        // Not enough movement, reset positions
                        if (activeCard) activeCard.style.transform = 'translateX(0)';
                        if (prevCard) prevCard.style.transform = 'translateX(-100%)';
                        if (nextCard) nextCard.style.transform = 'translateX(100%)';
                    }
                    
                    isDragging = false;
                }
                
                // Mouse handlers (for desktop testing)
                function handleMouseDown(e) {
                    startX = e.clientX;
                    isDragging = true;
                    
                    // Get cards
                    const activeCard = document.querySelector('.gem-card.active');
                    const prevCard = document.querySelector('.gem-card.prev');
                    const nextCard = document.querySelector('.gem-card.next');
                    
                    // Reset transitions
                    if (activeCard) activeCard.style.transition = 'none';
                    if (prevCard) prevCard.style.transition = 'none';
                    if (nextCard) nextCard.style.transition = 'none';
                    
                    e.preventDefault();
                }
                
                function handleMouseMove(e) {
                    if (!isDragging) return;
                    
                    currentX = e.clientX;
                    const diffX = currentX - startX;
                    
                    // Get cards
                    const activeCard = document.querySelector('.gem-card.active');
                    const prevCard = document.querySelector('.gem-card.prev');
                    const nextCard = document.querySelector('.gem-card.next');
                    
                    if (activeCard) activeCard.style.transform = `translateX(${diffX}px)`;
                    
                    // Move adjacent cards proportionally
                    if (diffX > 0 && prevCard) {
                        // Swiping right, show prev card
                        prevCard.style.transform = `translateX(calc(-100% + ${diffX}px))`;
                    } else if (diffX < 0 && nextCard) {
                        // Swiping left, show next card
                        nextCard.style.transform = `translateX(calc(100% + ${diffX}px))`;
                    }
                }
                
                function handleMouseUp(e) {
                    if (!isDragging) return;
                    
                    // Get cards and restore transitions
                    const activeCard = document.querySelector('.gem-card.active');
                    const prevCard = document.querySelector('.gem-card.prev');
                    const nextCard = document.querySelector('.gem-card.next');
                    
                    if (activeCard) activeCard.style.transition = 'transform 0.3s ease-out';
                    if (prevCard) prevCard.style.transition = 'transform 0.3s ease-out';
                    if (nextCard) nextCard.style.transition = 'transform 0.3s ease-out';
                    
                    // Calculate swipe distance
                    const diffX = currentX - startX;
                    
                    if (diffX > threshold) {
                        // Swiped right - go to previous
                        updateActiveGem(getPrevIndex(activeGemIndex));
                    } else if (diffX < -threshold) {
                        // Swiped left - go to next
                        updateActiveGem(getNextIndex(activeGemIndex));
                    } else {
                        // Not enough movement, reset positions
                        if (activeCard) activeCard.style.transform = 'translateX(0)';
                        if (prevCard) prevCard.style.transform = 'translateX(-100%)';
                        if (nextCard) nextCard.style.transform = 'translateX(100%)';
                    }
                    
                    isDragging = false;
                }
            }
            
            // Function to create all gem cards
            function createGemCards() {
                const cardsContainer = document.querySelector('.cards-container');
                cardsContainer.innerHTML = '';
                
                // Create a card for each gem
                hiddenGems.forEach((gem, index) => {
                    const card = document.createElement('div');
                    card.className = 'gem-card';
                    card.id = `card-${index}`;
                    
                    // Set initial position (active, prev, next)
                    if (index === activeGemIndex) {
                        card.classList.add('active');
                    } else if (index === getPrevIndex(activeGemIndex)) {
                        card.classList.add('prev');
                    } else if (index === getNextIndex(activeGemIndex)) {
                        card.classList.add('next');
                    }
                    
                    // Emoji for card image
                    const emojiMap = {
                        'nature': 'üå≤',
                        'food': 'üç∑',
                        'cultural': 'üèõÔ∏è'
                    };
                    
                    // Card content
                    card.innerHTML = `
                        <div class="card-handle"></div>
                        <div class="card-content">
                            <div class="card-image">${emojiMap[gem.category] || 'üìç'}</div>
                            <div class="card-details">
                                <h3 class="card-title">${gem.title}</h3>
                                <div class="card-address">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                                    </svg>
                                    <span>${gem.address}</span>
                                </div>
                                <div class="card-hours">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                        <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/>
                                        <path d="M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
                                    </svg>
                                    <span>${gem.hours}</span>
                                </div>
                                <button class="add-to-trip-btn" data-gem-id="${gem.id}">Add to Itinerary</button>
                            </div>
                        </div>
                    `;
                    
                    cardsContainer.appendChild(card);
                });
                
                // Add event listeners to all "Add to Itinerary" buttons
                document.querySelectorAll('.add-to-trip-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        this.textContent = 'Added to Itinerary';
                        this.style.backgroundColor = '#27ae60';
                        
                        // Would typically update state here in a real app
                        setTimeout(() => {
                            this.textContent = 'Add to Itinerary';
                            this.style.backgroundColor = '#3a3a3a';
                        }, 2000);
                    });
                });
            }
            
            // Create swipe indicators (dots)
            function createSwipeIndicators() {
                const indicatorContainer = document.querySelector('.swipe-indicator');
                indicatorContainer.innerHTML = '';
                
                // Create a dot for each gem
                hiddenGems.forEach((_, index) => {
                    const dot = document.createElement('div');
                    dot.className = 'dot';
                    if (index === activeGemIndex) {
                        dot.classList.add('active');
                    }
                    indicatorContainer.appendChild(dot);
                });
            }
            
            // Helper functions to get previous and next indices
            function getPrevIndex(currentIndex) {
                return (currentIndex - 1 + hiddenGems.length) % hiddenGems.length;
            }
            
            function getNextIndex(currentIndex) {
                return (currentIndex + 1) % hiddenGems.length;
            }
            
            // Helper function to calculate distance between coordinates
            function calculateDistance(point1, point2) {
                const dx = point1[0] - point2[0];
                const dy = point1[1] - point2[1];
                return Math.sqrt(dx * dx + dy * dy);
            }
            
            // Helper function to get color based on category
            function getCategoryColor(category) {
                const colorMap = {
                    'nature': '#27ae60',
                    'food': '#e74c3c',
                    'cultural': '#9b59b6'
                };
                
                return colorMap[category] || '#3498db';
            }
        });
    </script>
</body>
</html>